webpackJsonp([2],[
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	var zcom = __webpack_require__(1);
	var PayBox = __webpack_require__(4);
	__webpack_require__(5);
	//当前动作状态(下拉:0,上拉:1,不动:2),默认为不动
	var flag = 2;
	var min_cnt = 0;
	var max_cnt = 10;
	var openid = "";
	var serial_no = '';
	$(function() {
	    QueryString.Initial();
	    openid = QueryString.GetValue("openid");
	    var data = refreshRecord();
	    iscrollObj = iscrollAssist.newVerScrollForPull($("#wrapper"), pullDownAction, pullUpAction);
	    iscrollObj.refresh();
	    initOneRcordReallyClick();
	    PayBox.init("", PayBoxCallbackFunc);

	});

	function refreshRecord(argument) {
	    if (openid == '' || openid == undefined) {
	        return;
	    }
	    getData();
	}

	// 发送同步请求数据  (模拟数据)
	function getData() {
	    var data = [];
	    var param = {
	        open_id: openid,
	        min_count: min_cnt,
	        max_count: max_cnt,
	        servlet_type: "query_order"
	    };

	    var url = LFQ_ORDER_CREATE_URL;

	    zcom.getAjax(url, param, function(msg) {
	        if (msg.error_response != undefined) {
	            alert(msg.error_response.sub_msg);
	            return;
	        }
	        if (msg.lft_orderinfo_response.resp_code != "0000") {
	            alert(msg.bind_response.resp_msg);
	            return;
	        } else {
	            data = msg.lft_orderinfo_response.lfqorderInfo_arrays.lfqorderInfo;
	            callbackFunc(data);
	        }

	    });

	    return data;
	}

	// 信用卡输入后六后回调函数
	function PayBoxCallbackFunc(PayBoxPassword) {
	    //fkmdata 跳转到付款码参数
	    reCreateOrder(openid,serial_no,PayBoxPassword);
	}

	// 请求数据后回调
	function callbackFunc(data) {
	    if (data == "" || data == undefined || data.length == 0) {
	        if (min_cnt > 0) {
	            min_cnt -= 10;
	            max_cnt -= 10;
	        }
	        return;
	    }
	    var pjHtml = pinjieHtml(data);
	    if (flag != 1) { //除了上拉,其他的都先清除
	        $("#detail").html("");
	    }
	    $("#detail").html(pjHtml);
	}

	// 拼接HTML
	function pinjieHtml(data) {
	    var pjHtml = '';
	    for (var i = 0, l = data.length; i < l; i++) {
	        var orderState = changeOrderState(data[i].order_state);
	        var thetime = changeTimeFormat(data[i].apply_date +"" + data[i].apply_time);
	        pjHtml += '<div class="oneRcord" data-type="' + orderState.iconClass + '"serial_no="' + data[i].serial_no +
	            '"><div class="w1"><div class="type-name">' + orderState.name +
	            '</div><div class="time-small">' + thetime + '</div></div>' +
	            '<div class="w2"><div class="number-big">' + data[i].stage_amt +
	            '</div><div class="stage-box"><span>' + data[i].out_stage_count +
	            '</span>/<span>' + data[i].total_stage_count + '</div></div>' +
	            '<div class="w3"><span class="fukuan_icon ' + orderState.iconClass + '"></span></div></div>';
	    }

	    return pjHtml;
	}

	function changeOrderState(orderState) {
	    //订单状态，01待消费,02分期待确认收货,03分期已确认收货,04已退货，99被拒绝状态
	    var stateObject = {};
	    if (orderState = "01") {
	        stateObject.iconClass = 'unpaid';
	        stateObject.name = "待消费";
	    } else if (orderState == "02" || orderState == "03") {
	        stateObject.iconClass = 'succeed';
	        stateObject.name = "分期成功";
	    } else if (orderState == '04') {
	        stateObject.iconClass = 'failed';
	        stateObject.name = "已退货";
	    } else if (orderState == "99") {
	        stateObject.iconClass = 'failed';
	        stateObject.name = "分期失败";
	    }

	    return stateObject;
	}


	function initOneRcordReallyClick() {
	    zcom.registerReallyClick($("#detail"));
	    $("#detail").on("reallyClick", function(e, $target) {
	    	serial_no = $target.parent().parent().attr("serial_no");
	        if ($target.parent().hasClass("w1") || $target.parent().hasClass("w2")) {
	            linkOrderDetails(serial_no);
	        } else if ($target.parent().hasClass("w3")) {
	            PayBox.restPwd();
	            PayBox.show();
	        }
	    });
	}
	// 点击订单记录时跳转到订单详情  initOneRcordEvent
	function linkOrderDetails() {
	    // 拼接html应该把订单信息写在对应的 div.oneRcord data-ddKey="" 作为跳转用
	    location.href = "./orderDetails.html?open_id="+openid+"&serial_no="+serial_no; //把订单Id作为参数 请求订单详情用
	}

	//重新生成该订单
	function   reCreateOrder( openid,serial_no,card_6_th){
		var param = {
				open_id   : openid,
				serial_no : serial_no ,
				card_6th  : card_6_th ,
				servlet_type : "recreate_order"
				};
		
		var url=LFQ_ORDER_CREATE_URL; 
		  zcom.getAjax(url, param, function(msg) {	  		  
		      if (msg.error_response != undefined) {
					alert(msg.error_response.sub_msg);
					return;
		       }

		       if (msg.lft_orderinfo_response.resp_code != "0000") {
					alert(msg.lft_orderinfo_response.resp_msg);
					return;
				}
			  
				if(retn.lft_orderinfo_response.resp_code=="0000"){  //如果成功 
					reserial_no=retn.serial_no;
					 window.location.href = "qrcodePay.html?payCode=" + retn.serial_no;
				 }else {
					 alert(msg.lft_orderinfo_response.resp_msg);
						return;
				 }
		  }); 
		
	}
	//查询单独的订单

	function   doQuerySingle(openid,serial_no){
		var param = {
				open_id   : openid,
				serial_no : serial_no ,
				servlet_type : "query_orderByOrderId"
				};
		
		var url=LFQ_ORDER_QUERY_URL; 
		  zcom.getAjax(url, param, function(msg) {	  		  
		      if (msg.error_response != undefined) {
					alert(msg.error_response.sub_msg);
					return;
		       }

		       if (msg.lft_orderinfo_response.resp_code != "0000") {
					alert(msg.bind_response.resp_msg);
					return;
				}
			  
				if(retn.lft_orderinfo_response.resp_code=="0000"){  //如果成功 
					reserial_no=retn.serial_no;
				 }
		  }); 
	}


	/**
	 * 下拉刷新
	 */
	function pullDownAction() {
	    flag = 0;
	    setTimeout(function() {
	        this.refresh();
	        min_cnt = 0;
	        max_cnt = 10;
	        refreshRecord();
	    }.bind(this), 1000);
	}

	/*上拉加载更多*/
	function pullUpAction() {
	    setTimeout(function() {
	        flag = 1;
	        this.refresh();
	        min_cnt += 10;
	        max_cnt += 10;
	        refreshRecord();
	    }.bind(this), 1000);
	}

	// 转换时间格式 为2016-04-05 09:26:26
	function changeTimeFormat(cxinfo_trans_time) {
	    var trans_time = String(cxinfo_trans_time);
	    trans_time_year = trans_time.substr(0, 4),
	        trans_time_month = trans_time.substr(4, 2),
	        trans_time_date = trans_time.substr(6, 2),
	        trans_time_hour = trans_time.substr(8, 2),
	        trans_time_minutes = trans_time.substr(10, 2);
	    //       trans_time_seconds = trans_time.substr(12, 2);
	    var trans_time = trans_time_year + "-" + trans_time_month + "-" + trans_time_date + " " + trans_time_hour + ":" + trans_time_minutes;
	    return trans_time;
	}

/***/ },
/* 1 */,
/* 2 */,
/* 3 */,
/* 4 */
/***/ function(module, exports) {

	/*
	 * 智能机浏览器版本信息:
	 *
	 */
	$("#clo_btn").click(function(e) {
		$("#pay_Box").hide();
		indexPwd = 0;
		restPwd();
	});
	$("#payBoxSure").on("touchend",function  () {
		if($("#payBoxSure").hasClass("btn_disabled")){
			return;
		}
		pwdVarify();
	});
	var PayBox = {
		password: ""
	};
	var indexPwd = 0;
	var browser = {
		versions: function() {
			var u = navigator.userAgent,
				app = navigator.appVersion;
			return { // 移动终端浏览器版本信息
				trident: u.indexOf('Trident') > -1, // IE内核
				presto: u.indexOf('Presto') > -1, // opera内核
				webKit: u.indexOf('AppleWebKit') > -1, // 苹果、谷歌内核
				gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, // 火狐内核
				mobile: !!u.match(/AppleWebKit.*Mobile.*/) || !!u.match(/AppleWebKit/), // 是否为移动终端
				ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), // ios终端
				android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, // android终端或者uc浏览器
				iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, // 是否为iPhone或者QQHD浏览器
				iPad: u.indexOf('iPad') > -1, // 是否iPad
				webApp: u.indexOf('Safari') == -1
					// 是否web应该程序，没有头部与底部
			};
		}(),
		language: (navigator.browserLanguage || navigator.language).toLowerCase()
	};
	var touchEvents = {
		touchstart: "touchstart",
		touchmove: "touchmove",
		touchend: "touchend",

		/**
		 * @desc:判断是否pc设备，若是pc，需要更改touch事件为鼠标事件，否则默认触摸事件
		 */
		initTouchEvents: function() {
			if (browser.versions.mobile == false) {
				this.touchstart = "mousedown";
				this.touchmove = "mousemove";
				this.touchend = "mouseup";
			}
		}
	};
	touchEvents.initTouchEvents();
	$(function() {
		$(".key").bind(touchEvents.touchstart, function(event) {
			//		event.preventDefault();// 阻止浏览器默认事件，重要 
			if (indexPwd >= 6) {
				return;
			} else {
				PayBox.password += "" + $(this).html();
				indexPwd = indexPwd + 1;
			}
			if (indexPwd == 1) {
				$("#pwdOne").html("●");
			}
			if (indexPwd == 2) {
				$("#pwdTwo").html("●");
			}
			if (indexPwd == 3) {
				$("#pwdThree").html("●");
			}
			if (indexPwd == 4) {
				$("#pwdFour").html("●");
			}
			if (indexPwd == 5) {
				$("#pwdFive").html("●");
			}
			if (indexPwd == 6) {
				$("#pwdSix").html("●");
				$("#payBoxSure").removeClass("btn_disabled");
				$("#payBoxSure").addClass("btn_primary")
				winHide();
				//			indexPwd = 0;
			}else{
				$("#payBoxSure").removeClass("btn_primary");
				$("#payBoxSure").addClass("btn_disabled")
			}
		});
	});

	function pwdVarify(param, callbackFunc) {

		/*		getAjax(url, param, function(msg) {
					callbackFunc(msg);
				})*/
		PayBox.callbackFunc(PayBox.password);
		if (true) {
			$("#pay_Box").hide();
		}
	}


	function winShow() {
		var arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
		$(".key").each(function(i) {
			var index = parseInt(Math.random() * arr.length);
			$(this).html(arr[index]);
			arr.splice(index, 1);
		});
		$("#popDiv").show();
	}

	//清空密码框
	function restPwd() {
		$("#pwdOne").html("&nbsp;");
		$("#pwdTwo").html("&nbsp;");
		$("#pwdThree").html("&nbsp;");
		$("#pwdFour").html("&nbsp;");
		$("#pwdFive").html("&nbsp;");
		$("#pwdSix").html("&nbsp;");
		PayBox.password = ""
	}

	function winHide() {
		$("#popDiv").hide();
	}

	function show(argument) {
		/*	getAjax(url, param, function(msg) {
				if (msg.varifyerror_response != undefined) {
					$("#error_Box").fadeIn();
					return;
				}
				if (msg.lock_response != undefined) {
					var times = msg.lock_response.sub_msg;
					$("#wrongNum2").html(times);
					$("#tip_Box").fadeIn();
					return;
				}
				indexPwd = 0;
				restPwd();
				$("#pay_Box").fadeIn(); //显示密码框
				winShow(); //弹出键盘
			});*/

		$("#pay_Box").show();
		winShow();
	}

	function delKey() {
		if (indexPwd == 1) {
			$("#pwdOne").html("&nbsp;");
		}
		if (indexPwd == 2) {
			$("#pwdTwo").html("&nbsp;");
		}
		if (indexPwd == 3) {
			$("#pwdThree").html("&nbsp;");
		}
		if (indexPwd == 4) {
			$("#pwdFour").html("&nbsp;");
		}
		if (indexPwd == 5) {
			$("#pwdFive").html("&nbsp;");
		}
		if (indexPwd == 6) {
			$("#pwdSix").html("&nbsp;");
		}
		if (indexPwd > 0) {
			indexPwd = indexPwd - 1;
		} else {
			return;
		}
		if (PayBox.password != "") {
			PayBox.password = PayBox.password.substring(0, PayBox.password.length - 1);
		}
	}
	function init(url,PayBoxCallbackFunc) {
		PayBox.callbackFunc = PayBoxCallbackFunc;
	}

	module.exports = {
		init: init,
		restPwd: restPwd,
		winShow: winShow,
		winHide: winHide,
		show: show,
		delKey:delKey
	}

/***/ },
/* 5 */
/***/ function(module, exports) {

	/**
	 * 滚动辅助模块
	 * 将来用requiry模块加载器 或ES6 做成一个独立模块
	 * @since 2016-04-07
	 */
	var jQueryZepto;
	if (typeof jQuery == 'undefined') {
	    jQueryZepto = Zepto;
	} else {
	    jQueryZepto = jQuery;
	}
	(function($, window) {

	    //模块对外提供的公共方法
	    var exportsMethods = {

	        /**
	         * 新建一个竖直滚动实例,并做一些处理,整合上拉下拉的功能
	         * wrapper        要渲染滚动实例的位置
	         * pulldownAction 下拉执行的逻辑
	         * pullupAction   上拉执行的逻辑
	         * opts           滚动个性化参数 
	         * pullText       拉动时不同状态要显示的文字
	         */
	        newVerScrollForPull: function(wrapper, pulldownAction, pullupAction, opts, pullText) {

	            var $wrapper;
	            if (typeof wrapper === 'string') {
	                $wrapper = $(wrapper);
	            } else if (typeof wrapper === 'object') {
	                $wrapper = wrapper;
	            }

	            var pulldownRefresh = pullText && pullText['pulldownRefresh'] ? pullText['pulldownRefresh'] : '下拉刷新...',
	                pullupLoadingMore = pullText && pullText['pullupLoadingMore'] ? pullText['pullupLoadingMore'] : '上拉加载更多...',
	                releaseToRefresh = pullText && pullText['releaseToRefresh'] ? pullText['releaseToRefresh'] : '松手开始刷新...',
	                releaseToLoading = pullText && pullText['releaseToLoading'] ? pullText['releaseToLoading'] : '松手开始加载...',
	                loading = pullText && pullText['loading'] ? pullText['loading'] : '加载中...';

	            var $pulldown = $wrapper.find('#pulldown'),
	                $pullup = $wrapper.find('#pullup'),
	                pullupOffset = 0,
	                pulldownOffset = 0;

	            if ($pulldown.length > 0) {
	                pulldownOffset = $pulldown.outerHeight ? $pulldown.outerHeight() : $pulldown.height();
	                $pulldown.find('#pulldown-label').html(pulldownRefresh);
	            }

	            if ($pullup.length > 0) {
	                pullupOffset = $pullup.outerHeight ? $pullup.outerHeight() : $pullup.height();;
	                $pullup.find('#pullup-label').html(pullupLoadingMore);
	            }

	            //这个属性很重要,目前V5版本不支持,需修改源码
	            var options = {
	                topOffset: pulldownOffset
	            };

	            $.extend(true, options, opts);

	            var scrollObj = this.newVerScroll($wrapper[0], options);

	            //滚动刷新触发的事件
	            scrollObj.on('refresh', function() {

	                var $pulldown = $wrapper.find('#pulldown'),
	                    $pullup = $wrapper.find('#pullup');

	                if ($pulldown.length > 0 && $pulldown.hasClass('loading')) {
	                    $pulldown.removeClass();
	                    $pulldown.find('#pulldown-label').html(pulldownRefresh);
	                } else if ($pullup.length > 0) {
	                    $pullup.find('#pullup-icon').show();
	                    if ($pullup.hasClass('loading')) {
	                        $pullup.find('#pullup-icon').show();
	                        $pullup.removeClass();
	                        $pullup.find('#pullup-label').html(pullupLoadingMore);
	                    }
	                }
	            });

	            //滚动的时候触发的事件
	            scrollObj.on('scrollMove', function() {

	                var $pulldown = $wrapper.find('#pulldown'),
	                    $pullup = $wrapper.find('#pullup');

	                if ($pulldown.length > 0 && this.y > 5 && !$pulldown.hasClass('flip')) {
	                    $pulldown.removeClass().addClass('flip');
	                    $pulldown.find('#pulldown-label').html(releaseToRefresh);
	                    this.minScrollY = 0;

	                } else if ($pulldown.length > 0 && this.y < 5 && $pulldown.hasClass('flip')) {
	                    $pulldown.removeClass();
	                    $pulldown.find('#pulldown-label').html(pulldownRefresh);
	                    this.minScrollY = -pulldownOffset;
	                    //this.y < this.minScrollY代表是上拉,以防下拉的时候未拉到尽头时进入上拉的逻辑中
	                } else if ($pullup.length > 0 && this.y < this.minScrollY && this.y < (this.maxScrollY - 5) && !$pullup.hasClass('flip')) {
	                    $pullup.removeClass().addClass('flip');
	                    $pullup.find('#pullup-label').html(releaseToLoading);
	                    this.maxScrollY = this.maxScrollY;

	                } else if ($pullup.length > 0 && (this.y > (this.maxScrollY + 5)) && $pullup.hasClass('flip')) {
	                    $pullup.removeClass();
	                    $pullup.find('#pullup-label').html(pullupLoadingMore);
	                    this.maxScrollY = pullupOffset;
	                }
	            });

	            //滚动结束之后触发的事件
	            scrollObj.on('scrollEnd', function() {

	                var $pulldown = $wrapper.find('#pulldown'),
	                    $pullup = $wrapper.find('#pullup');

	                if ($pulldown.length > 0 && $pulldown.hasClass('flip')) {
	                    $pulldown.removeClass().addClass('loading');
	                    $pulldown.find('#pulldown-label').html(loading);
	                    if (typeof pulldownAction === 'function') {
	                        pulldownAction.call(scrollObj);
	                    }
	                } else if ($pullup.length > 0 && $pullup.hasClass('flip')) {
	                    $pullup.removeClass().addClass('loading');
	                    $pullup.find('#pullup-label').html(loading);
	                    if (typeof pullupAction === 'function' && $pullup.parent().length > 0) {
	                        pullupAction.call(scrollObj);
	                    }
	                }
	            });

	            return scrollObj;
	        },
	        /**
	         * 创建一个竖直方向的滚动实例
	         * @param obj    dom对象或者选择字符串
	         * @param option 滚动其他属性
	         * @return IScroll实例对象
	         */
	        newVerScroll: function(dom, option) {
	            var opt = {
	                scrollbars: true, //是否有滚动条
	                useTransition: false
	            };
	            if (option) {
	                $.extend(opt, option);
	            }
	            var iSObj = new IScroll(dom, opt);

	            //滚动条在滚动时显示出来,滚动结束隐藏
	            //V5以前版本有个参数可以设置,V5之后目前只能手动处理滚动条的显示隐藏或者可从外部传个参数进来判断
	            iSObj.on("scrollEnd", function() {
	                if (this.indicator1) {
	                    this.indicator1.indicatorStyle['transition-duration'] = '350ms';
	                    this.indicator1.indicatorStyle['opacity'] = '0';
	                }
	            });
	            iSObj.on("scrollMove", function() {
	                if (this.indicator1) {
	                    this.indicator1.indicatorStyle['transition-duration'] = '0ms';
	                    this.indicator1.indicatorStyle['opacity'] = '0.8';
	                }
	            });
	            return iSObj;
	        }
	    };

	    window.iscrollAssist = exportsMethods;

	})(jQueryZepto, window);

/***/ }
]);